<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<style>
	* {
		user-select: none;
	}

	::-webkit-scrollbar {
		display: none
	}

	div {
		/* -webkit-user-drag: none; */
	}

	body {
		background-color: rgb(39, 19, 58);
	}
</style>

<body>
	<div id="f1"
		style="height: 30px; width: 30px; position: absolute; z-index: 99; left: 120px; top: 120px; background-color:rgb(219, 85, 163);">
	</div>
	<div style="color: rgb(240, 248, 255); font: 1em 新宋体;">&nbsp;Hello,</div>
</body>

<script>
	//获取元素
	var dv = document.getElementById('f1');
	var x = 0;
	var y = 0;
	var l = 0;
	var t = 0;
	var isDown = false;

	dv.onmousedown = function (e) {
		//获取鼠标初始x坐标和y坐标
		x = e.clientX;
		y = e.clientY;
		//获取移动元素左部和顶部的偏移量
		l = f1.offsetLeft;
		t = f1.offsetTop;

		isDown = true;
	}
	window.onmousemove = function (e) {
		if (isDown == false) {
			return;
		}
		//获取x和y
		var nx = e.clientX;
		var ny = e.clientY;
		//计算移动后的左偏移量和顶部的偏移量
		var nl = nx - (x - l);
		var nt = ny - (y - t);

		dv.style.left = nl + 'px';
		dv.style.top = nt + 'px';
	}
	dv.onmouseup = function () {
		//开关关闭
		isDown = false;
		dv.style.cursor = 'default';
	}


	let keyStateSet = new Set();
	let intervalID;
	document.onkeydown = function (evt) {
		evt.preventDefault();
		console.info("onkeydown");
		if (keyStateSet.size == 0) document.dispatchEvent(new Event("keyStateChange"));
		keyStateSet.add(evt.keyCode);
	}
	document.onkeyup = function (evt) {
		evt.preventDefault();
		console.info("onkeyup");
		keyStateSet.delete(evt.keyCode);
	}

	document.addEventListener("keyStateChange", function (e) {
		if (keyStateSet.size == 0) clearInterval(intervalID);
		intervalID = setInterval(function () {
			if (keyStateSet.has(37))
				dv.style.left = Number.parseInt(dv.style.left.substr(0, dv.style.left.length - 2)) - 6 + "px";
			if (keyStateSet.has(38))
				dv.style.top = Number.parseInt(dv.style.top.substr(0, dv.style.top.length - 2)) - 6 + "px";
			if (keyStateSet.has(39))
				dv.style.left = Number.parseInt(dv.style.left.substr(0, dv.style.left.length - 2)) + 6 + "px";
			if (keyStateSet.has(40))
				dv.style.top = Number.parseInt(dv.style.top.substr(0, dv.style.top.length - 2)) + 6 + "px";
		}, 10);
	});


	function sleep(ms) {
		return new Promise(resolve => setTimeout(resolve, ms))
	}


</script>



</html>
